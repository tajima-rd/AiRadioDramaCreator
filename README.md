# AiRadioDramaCreator

## 概要

`AiRadioDramaCreator` は、Googleの生成AIモデルを活用して、ラジオドラマの音声コンテンツを効率的に制作するためのデスクトップアプリケーションです。

このアプリケーションは、単純なテキストから音声を作るだけでなく、**「①シナリオから台本を生成 → ②台本からSSML（音声合成マークアップ言語）を生成 → ③SSMLから最終的な音声ファイルを生成」**という段階的な制作フローを採用しています。各ステップで中間生成物を確認・編集できるため、柔軟で高品質なコンテンツ制作が可能です。すでに台本ファイルが存在する場合には、**「①シナリオから台本を生成」**のプロセスを飛ばすことも可能です。


## 主要な機能

-   **段階的な生成フロー**: シナリオ → 台本 → SSML → 音声という3つの独立したステージでコンテンツを生成。各段階での確認や手動編集が可能です。
-   **プロジェクトベースの管理**: `project.json` ファイルにより、APIキー、モデル設定、話者、ファイルパスなどをプロジェクト単位で一元管理します。
-   **直感的なGUI**: 4分割されたリスト表示により、各ステージのファイル（シナリオ、台本、SSML、音声）を直感的に把握・操作できます。
-   **AIによる相槌自動生成**: 台本からSSMLを生成する際に、会話の流れを解析し、聞き手の自然な相槌をAIが自動で挿入します。
-   **柔軟な設定**: 専用ダイアログを通じて、複数のAPIキー、使用するGeminiモデル、話者ごとの声（ボイス）を視覚的に設定・保存できます。
-   **リアルタイムログと中断機能**: 処理の進捗やエラーをリアルタイムで確認でき、時間のかかる処理も安全に中断できます。

## プログラムの構造

```
AiRadioDramaCreator/
├── core/ # アプリケーションのコアロジック
│ ├── api_client.py # APIクライアント (ApiKeyManager, GeminiApiClient)
│ ├── configs.py # 設定クラス (Project, SpeechConfigなど)
│ ├── generators.py # テキスト・音声データの生成処理
│ └── orchestrator.py # 各生成ステージを実行する中核関数群
├── gui/ # グラフィカルユーザーインターフェース関連
│ ├── app_ui_setup.py # UI要素の構築・レイアウト定義
│ ├── dialogs.py # 各種設定ダイアログ
│ ├── main_window.py # メインウィンドウのロジックとイベントハンドラ
│ └── run.py # GUIアプリケーションの起動スクリプト
├── utils/ # ユーティリティ関数
│ ├── project_loader.py # project.json の読み込み・保存
│ ├── ssml_utils.py # SSML変換ユーティリティ
│ └── text_processing.py # 話者抽出や相槌挿入などのテキスト処理
├── main.py # アプリケーションのエントリーポイント (CLI/GUIモード)
├── project.json # プロジェクト設定ファイルのサンプル
└── requirements.txt # 依存ライブラリリスト
```

## プロジェクトの構造

```
../Project  # ユーザーが作成したプロジェクトのルートフォルダ
├── audio   # 最終的に出力された音声ファイル（MP3＋WAV）
├── dialog  # 実際にAIが読み上げるための台本（読み上げ原稿）
├── persona # 話者の定義ファイルの配置（現在は未実装）
├── script  # 元となるシナリオ。自由記述のテキストファイル。
└── ssml    # 生成AIに読み込ませるためのSSMLテキスト（XML形式）
```

## 台本ファイルについて
現在のバージョンでは、シナリオから台本の生成が上手くいかないケースもあります。その場合は、別途作成した台本ファイルを **../Project/dialog** に配置することも可能です。台本ファイルの形式は以下の通りです。

### 台本ファイルの例：

```
弥千代: さっきの音声、すごく自然な会話だったわね。GoogleのNotebookLMというツールにも、文章をラジオドラマ風に音声化する機能があるらしいけど。

喜一: うん、でもNotebookLMだと、AIが自動で要約して喋ってくれるから、必ずしも喋ってほしい内容を、意図した通りに話してくれるわけではないんだって。だから、より細かい制御をするにはプログラミングの力が必要になるんだ。

弥千代: なるほど。じゃあ藤本さんはどうやって、あの自然な掛け合いを作ったのかしら。

喜一: まず、生成AIに「やちよさんとキーチさん」という二人の人物の会話文を作らせたんだ。僕たちと同じ名前だね。

弥千代: まあ、奇遇ね！それで、その会話文をどうやって音声にしたの？
```

地名や氏名、専門用語などは、音声生成の際に上手く発音できないことがあります。その場合には、漢字をひらがなに直すなどの工夫が必要となります。

## インストール

### 前提条件

-   Python 3.11 以上
-   pip (Pythonのパッケージインストーラー)
-   **FFmpeg**: MP3形式の音声ファイルを生成するために必要です。お使いのOSに合ったFFmpegをダウンロードし、システムPATHに追加してください。
    -   [FFmpeg 公式サイト](https://ffmpeg.org/download.html)

### セットアップ手順

1.  **リポジトリをクローンする**:
    ```bash
    git clone https://github.com/tajima-rd/AiRadioDramaCreator.git
    cd AiRadioDramaCreator
    ```

2.  **仮想環境の作成と有効化 (推奨)**:
    ```bash
    # PyQtの環境はシステムにインストールされているものを使用する。
    python3 -m venv venv --system-site-packages
    source venv/bin/activate  # macOS / Linux
    # venv\Scripts\activate   # Windows
    ```

3.  **Pythonの依存関係をインストールする**:
    ```bash
    pip install -r requirements.txt
    ```
    (`requirements.txt` の例)
    ```text
    google-genai~=1.28.0
    pydub~=0.25.1
    ```

## 使い方

### 1. プロジェクト設定 (`project.json`) の準備

1.  `project.json` をコピーして、あなた自身のプロジェクト設定ファイルを作成します。
2.  ファイル内の各項目を編集します。
    -   `root_path`: このプロジェクトのファイルを保存するフォルダの絶対パスを指定します。（例: `"/home/user/documents/MyRadioDrama"`）
    -   `api_keys`: Google Gemini APIのAPIキーをリストとして設定します。
    -   `speech_model`: 音声生成モデル名（例: `gemini-1.5-flash`）。
    -   `text_model`: テキスト生成モデル名（例: `gemini-1.5-flash`）。
    -   `speakers`: `{"話者名": "ボイス名"}` の形式で設定します。ボイス名はUI上のダイアログから選択できます。

### 2. アプリケーションの起動

ターミナルで以下のコマンドを実行します。

```bash
python main.py
```

あるいは、

```bash
python3 main.py
```

### 3. 音声生成のワークフロー
アプリケーションが起動したら、以下の手順で音声を生成します。

1.  プロジェクトを開く:
    -   メニューの「プロジェクト」→「プロジェクトを開く...」から、準備した project.json を選択します。
    -   UIの各リストがプロジェクトフォルダの内容で更新されます。
2.  【ステージ1】 台本の生成:
    -   左上の「処理対象のシナリオファイル一覧」から、台本にしたいシナリオファイルを選択します。
    -   選択したファイルの台本生成を開始 ボタンをクリックします。
    -   処理が完了すると、右上の「処理対象のダイヤログファイル一覧」が更新されます。
3.  【ステージ2】 SSMLの生成:
    -   右上の「処理対象のダイヤログファイル一覧」から、SSMLに変換したい台本ファイルを選択します。
    -   選択したファイルのSSML生成を開始 ボタンをクリックします。
    -   処理が完了すると、左下の「処理対象のSSMLファイル一覧」が更新されます。
4.  【ステージ3】 音声の生成:
    -   左下の「処理対象のSSMLファイル一覧」から、音声にしたいSSMLファイルを選択します。
    -   選択したファイルの音声生成を開始 ボタンをクリックします。
    -   処理が完了すると、右下の「処理後の音声ファイル一覧」が更新されます。

## APIキーの管理とセキュリティ
-   APIキーは機密情報です。Gitリポジトリに直接コミットしないでください。
